var indexContent=$("#index"),addContent=$("#add"),registerContent=$("#register"),homeContent=$("#home"),uploadContent=$("#upload");addContent.hide(),registerContent.hide(),homeContent.hide(),uploadContent.hide(),$("#msg").hide();var animateTime=400,User=function(){var e=this;e.id=ko.observable(),e.schoolId=ko.observable(),e.username=ko.observable(),e.password=ko.observable(),e.email=ko.observable(),e.firstName=ko.observable(),e.lastName=ko.observable(),e.role=ko.observable()},Course=function(){var e=this;e.id=ko.observable(),e.CourseName=ko.observable(),e.describe=ko.observable(),e.deadline=ko.observable()},Upload=function(){var e=this;e.schoolId=ko.observable()},showMessage=function(e){$("#msg").show(animateTime),$("#message").html(e),setTimeout(function(){$("#msg").hide(animateTime)},3e3)},viewModel=function(){var e=this;e.curUser=ko.observable(new User),e.username=ko.observable(),e.pwd=ko.observable(),e.reg_username=ko.observable(),e.reg_schoolId=ko.observable(),e.reg_password=ko.observable(),e.reg_email=ko.observable(),e.reg_firstName=ko.observable(),e.reg_lastName=ko.observable(),e.home_courses=ko.observableArray(),e.home_date=ko.observable(),e.home_uploads=ko.observableArray(),e.fullName=ko.computed(function(){return e.curUser().firstName+e.curUser().lastName}),e.regC_courseName=ko.observable(),e.regC_describe=ko.observable(),e.regC_deadline=ko.observable(),e.upload_schoolId=ko.computed(function(){return e.curUser().schoolId}),e.upload_student=ko.computed(function(){return e.fullName()}),e.upload_course=ko.observableArray(),e.upload_homework=ko.observable(),e.addPage=function(){addContent.show(animateTime)},e.uploadPage=function(){uploadContent.show(animateTime)},e.closeUpload=function(){uploadContent.hide(animateTime)},e.closeAdd=function(){addContent.hide(animateTime)},e.postUpload=function(){$.post("/upload",{schoolId:e.upload_schoolId,student:e.upload_student,course:e.upload_course,homework:e.upload_homework},function(o){showMessage(o.msg),e.signin(),e.closeUpload()})},e.postRegister=function(){$.post("/registerCourse",{CourseName:e.regC_courseName,describe:e.regC_describe,deadline:e.regC_deadline},function(o){showMessage(o.msg),e.signin(),e.closeAdd()})};var o=function(o){e.home_courses(o.courses),e.home_date(o.date),e.home_uploads(o.uploads),e.curUser(o.user),e.upload_course([]);for(var s in e.home_courses())$("#select").append($("<option>"+e.home_courses()[s].CourseName+"</option>"));"teacher"==e.curUser().role?($(".teacherPage").show(),$(".studentPage").hide()):($(".studentPage").show(),$(".teacherPage").hide());var a=$("#courseList tbody");a.empty();for(var s in e.home_courses()){var t=$("<tr></tr>");t.append($("<td>"+e.home_courses()[s].CourseName+"</td>")),t.append($("<td>"+e.home_courses()[s].describe+"</td>")),t.append($("<td>"+e.home_courses()[s].deadline+"</td>")),a.append(t)}var r=$("#uploadList tbody");r.empty();for(var s in e.home_uploads()){var t=$("<tr></tr>");t.append($("<td>"+e.home_uploads()[s].schoolId+"</td>")),t.append($("<td>"+e.home_uploads()[s].student+"</td>")),t.append($("<td>"+e.home_uploads()[s].course+"</td>")),t.append($("<td>"+e.home_uploads()[s].uploadDate+"</td>")),t.append($("<td>"+e.home_uploads()[s].score+"</td>")),r.append(t)}};e.signin=function(){$.post("/login",{username:e.username(),password:e.pwd()},function(e){o(e),indexContent.hide(animateTime),homeContent.show(animateTime)})},e.finishRegister=function(){$.post("/signup",{username:e.reg_username(),schoolId:e.reg_schoolId(),password:e.reg_password(),email:e.reg_email(),firstName:e.reg_firstName(),lastName:e.reg_lastName()},function(e){o(e),registerContent.hide(animateTime),homeContent.show(animateTime)})},e.signout=function(){homeContent.hide(animateTime),indexContent.show(animateTime)},e.register=function(){indexContent.hide(animateTime),registerContent.show(animateTime)}};ko.applyBindings(new viewModel);